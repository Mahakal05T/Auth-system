<!-- templates/hr_dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HR Dashboard - {{ department }} Department</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex">

<!-- Sidebar -->
<aside class="w-64 bg-white shadow p-5">
    <h1 class="text-2xl font-bold mb-6">HR Dashboard</h1>
    <nav class="flex flex-col gap-2">
        <a href="#" class="text-gray-700 hover:text-blue-600">Home</a>
        <a href="#" class="text-gray-700 hover:text-blue-600">Employees</a>
        <a href="#" class="text-gray-700 hover:text-blue-600">Departments</a>
        <a href="#" id="logoutLink" class="inline-flex items-center gap-2 px-3 py-2 rounded-md text-sm bg-white border hover:shadow-sm">
              <i data-lucide="log-out" class="w-4 h-4 text-gray-600"></i>
              <span class="text-gray-700">Logout</span>
        </a>
    </nav>
</aside>

<!-- Main Content -->
<main class="flex-1 p-6">
    <h2 class="text-2xl font-semibold mb-4">Employees - {{ department }} Department</h2>

    {% if employees %}
    <div class="overflow-x-auto">
        <table class="min-w-full bg-white shadow rounded-lg">
            <thead>
                <tr class="bg-gray-200 text-gray-700">
                    <th class="py-2 px-4">Employee ID</th>
                    <th class="py-2 px-4">Name</th>
                    <th class="py-2 px-4">Email</th>
                    <th class="py-2 px-4">Phone</th>
                    <th class="py-2 px-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for emp in employees %}
                <tr class="border-b hover:bg-gray-50">
                    <td class="py-2 px-4">{{ emp.emp_id }}</td>
                    <td class="py-2 px-4">{{ emp.name }}</td>
                    <td class="py-2 px-4">{{ emp.email }}</td>
                    <td class="py-2 px-4">{{ emp.phone }}</td>
                    <td class="py-2 px-4">
                        <a href="#" class="text-blue-600 hover:underline">Edit</a>
                        <a href="#" class="text-red-600 hover:underline ml-2">Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <p class="text-gray-600 mt-4">No employees found in your department.</p>
    {% endif %}
</main>
<script>
const logoutLink = document.getElementById('logoutLink');

const handleLogout = async (e) => {
  e.preventDefault();

  const accessToken = localStorage.getItem('access_token');

  try {
    // Call the backend logout endpoint
    await fetch('/logout', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${accessToken}`
      }
    });
  } catch (error) {
    console.error('Logout API call failed, continuing client-side cleanup.');
  }

  // Remove tokens from localStorage
  localStorage.removeItem('access_token');
  localStorage.removeItem('refresh_token');

  // Delete cookies (for JWTs possibly stored in cookies)
  document.cookie.split(";").forEach(c => {
    document.cookie = c
      .replace(/^ +/, "")
      .replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
  });

  // Redirect to login page
  window.location.href = '/login';
};

// âœ… Attach logout event correctly
if (logoutLink) {
  logoutLink.addEventListener('click', handleLogout);
}
</script>
</body>
</html>
