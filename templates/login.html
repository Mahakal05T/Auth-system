<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
.animate-slideDown { animation: slideDown 0.3s ease; }
@keyframes slideDown { from { transform: translateY(-20px); opacity:0 } to { transform: translateY(0); opacity:1 } }
</style>
</head>

<body class="bg-gradient-to-br from-purple-700 via-indigo-700 to-blue-700 min-h-screen flex items-center justify-center p-4">

<!-- Login Card -->
<div class="bg-white/10 backdrop-blur-2xl border border-white/20 rounded-3xl shadow-2xl w-full max-w-md p-8 text-white space-y-6">

  <!-- Title -->
  <div class="text-center">
    <h2 class="text-3xl font-bold">Welcome Back</h2>
    <p class="text-gray-300 mt-1">Sign in to your account</p>
  </div>

  <!-- Single Login Form -->
  <form id="loginForm" class="flex flex-col gap-4 relative animate-slideDown">
    <input type="text" id="identifier" placeholder="Employee ID or Email" required
      class="bg-white/10 border border-white/20 rounded-lg px-4 py-2 w-full placeholder-gray-300 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400">

    <div class="relative">
      <input type="password" id="password" placeholder="Password" required
        class="bg-white/10 border border-white/20 rounded-lg px-4 py-2 w-full placeholder-gray-300 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400">
      <button type="button" id="togglePassword" class="absolute right-3 top-2 text-gray-300 hover:text-white text-lg">üëÅÔ∏è</button>
    </div>

    <div class="flex items-center justify-between text-sm">
      <label class="flex items-center gap-2 text-gray-300">
        <input type="checkbox" class="accent-cyan-400"> Remember me
      </label>
      <a href="{{ url_for('forgot_password') }}" class="text-cyan-300 hover:underline">Forgot password?</a>
    </div>

    <button type="submit"
      class="bg-gradient-to-r from-cyan-400 to-blue-500 text-white font-semibold py-2 rounded-lg hover:from-cyan-500 hover:to-blue-600 shadow-lg transition">Login</button>

    <div class="flex items-center gap-2 text-sm text-gray-400 mt-2">
      <div class="flex-1 border-t border-gray-500"></div>
      <span>or continue with</span>
      <div class="flex-1 border-t border-gray-500"></div>
    </div>

    <div class="flex justify-center gap-3">
      <button type="button" class="w-1/2 bg-white/10 hover:bg-white/20 text-gray-200 font-medium rounded-lg py-2 flex items-center justify-center gap-2">
        <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google" class="w-5 h-5"> Google
      </button>
      <button type="button" class="w-1/2 bg-white/10 hover:bg-white/20 text-gray-200 font-medium rounded-lg py-2 flex items-center justify-center gap-2">
        <img src="https://www.svgrepo.com/show/349375/github.svg" alt="GitHub" class="w-5 h-5 invert"> GitHub
      </button>
    </div>

    <p class="text-center text-sm text-gray-300">
      Don‚Äôt have an account?
      <a href="#" class="text-cyan-400 hover:underline font-medium">Sign up</a>
    </p>
  </form>
</div>

<!-- Toast + Spinner -->
<div id="toast-container" class="fixed top-4 right-4 space-y-2 z-50"></div>
<div id="loading-spinner" class="hidden fixed inset-0 bg-black bg-opacity-25 flex items-center justify-center z-50">
  <div class="w-12 h-12 border-4 border-cyan-400 border-t-transparent rounded-full animate-spin"></div>
</div>

<!-- ‚úÖ JavaScript -->
<script>
// Toast Notification
function showToast(message, type = "success") {
  const toast = document.createElement("div");
  toast.className = `px-4 py-2 rounded shadow text-white ${type==='error'?'bg-red-500':'bg-green-500'} animate-slideDown`;
  toast.textContent = message;
  document.getElementById("toast-container").appendChild(toast);
  setTimeout(()=>toast.remove(),4000);
}

// Password toggle
const togglePassword = document.getElementById("togglePassword");
const passwordInput = document.getElementById("password");
togglePassword.addEventListener("click", () => {
  if(passwordInput.type==="password"){
    passwordInput.type="text"; togglePassword.textContent="üôà";
  } else {
    passwordInput.type="password"; togglePassword.textContent="üëÅÔ∏è";
  }
});


// üîê Helper: set cookie
function setCookie(name, value, minutes) {
  const expires = new Date(Date.now() + minutes * 60 * 1000).toUTCString();
  document.cookie = `${name}=${value}; expires=${expires}; path=/; Secure; SameSite=Strict`;
}

// Login Handler (Unified)
async function handleLogin(identifier, password){
  if(!identifier || !password){
    showToast("‚ùå Enter credentials","error");
    return;
  }

  document.getElementById("loading-spinner").classList.remove("hidden");
  try{
    const res = await fetch("/login", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({identifier, password})
    });

    const data = await res.json().catch(()=>({}));
    document.getElementById("loading-spinner").classList.add("hidden");

    if(res.ok){
      showToast("‚úÖ "+data.message,"success");
      // ‚úÖ Store JWT tokens in cookies (so Flask can verify automatically)
      if (data.access_token) setCookie("access_token_cookie", data.access_token, 60); // 60 min
      if (data.refresh_token) setCookie("refresh_token_cookie", data.refresh_token, 7*24*60); // 7 days

      setTimeout(()=>{ window.location.href = data.redirect; },1000);
    } else {
      showToast(data.error||"‚ùå Login failed","error");
    }
  } catch(err){
    document.getElementById("loading-spinner").classList.add("hidden");
    showToast("‚ùå Something went wrong","error");
  }
}

// Form Submit
document.getElementById("loginForm").addEventListener("submit", e=>{
  e.preventDefault();
  handleLogin(
    document.getElementById("identifier").value,
    document.getElementById("password").value
  );
});
</script>

</body>
</html>
